<!DOCTYPE html>
<html lang="en" class="dark"> <!-- Default to dark theme -->

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIDEFEND Framework Viewer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            /* Light Theme */
            --bg-color: #f0f2f5;
            --text-color: #37474f;
            --text-secondary-color: #607d8b;
            --header-bg: #ffffff;
            --header-border: #e0e0e0;
            --column-bg: #ffffff;
            --column-border: #e0e0e0;
            --column-header-text: #455a64;
            --column-header-hover-text: #1976d2;
            --technique-item-bg: #ffffff;
            --technique-item-border: #e8eaf6;
            --technique-item-text: #2196f3;
            --technique-item-hover-bg: #e3f2fd;
            --technique-item-hover-text: #1565c0;
            --technique-item-highlight-bg: #bbdefb;
            --technique-item-highlight-text: #0d47a1;
            --technique-id-text: #78909c;
            --modal-content-bg: #ffffff;
            --modal-close-btn-text: #757575;
            --modal-close-btn-hover-text: #212121;
            --search-bg: #eceff1;
            --search-border: #b0bec5;
            --search-focus-ring: #2196f3;
            --scrollbar-track: #e0e0e0;
            --scrollbar-thumb: #90a4ae;
            --scrollbar-thumb-hover: #78909c;
            --icon-fill: #607d8b;
            --icon-hover-fill: #2196f3;
            --link-color: #1976d2;
            --link-hover-color: #0d47a1;
            --shadow-umbra: rgba(0, 0, 0, 0.15);
            --shadow-penumbra: rgba(0, 0, 0, 0.1);
            --shadow-ambient: rgba(0, 0, 0, 0.08);
            --footer-bg: #e0e0e0;
            --footer-text: #757575;
            --footer-border: #c0c0c0;
        }
        html.dark {
            /* Dark Theme */
            --bg-color: #1a1a1a;
            --text-color: #e0e0e0;
            --text-secondary-color: #b0b0b0;
            --header-bg: #222222;
            --header-border: #333333;
            --column-bg: #222222;
            --column-border: #333333;
            --column-header-text: #f0f0f0;
            --column-header-hover-text: #90caf9;
            --technique-item-bg: #2b2b2b;
            --technique-item-border: #3d3d3d;
            --technique-item-text: #90caf9;
            --technique-item-hover-bg: #383838;
            --technique-item-hover-text: #bbdefb;
            --technique-item-highlight-bg: #1e3a5f;
            --technique-item-highlight-text: #e3f2fd;
            --technique-id-text: #c0c0c0;
            --modal-content-bg: #222222;
            --modal-close-btn-text: #b0b0b0;
            --modal-close-btn-hover-text: #f0f0f0;
            --search-bg: #333333;
            --search-border: #444444;
            --search-focus-ring: #90caf9;
            --scrollbar-track: #2b2b2b;
            --scrollbar-thumb: #555555;
            --scrollbar-thumb-hover: #777777;
            --icon-fill: #c0c0c0;
            --icon-hover-fill: #90caf9;
            --link-color: #90caf9;
            --link-hover-color: #e3f2fd;
            --shadow-umbra: rgba(0, 0, 0, 0.5);
            --shadow-penumbra: rgba(0, 0, 0, 0.35);
            --shadow-ambient: rgba(0, 0, 0, 0.3);
            --footer-bg: #2b2b2b;
            --footer-text: #a0a0a0;
            --footer-border: #3d3d3d;
        }

        html {
            height: 100%;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s ease, color 0.3s ease;
            min-height: 100%;
            display: flex;
            flex-direction: column;
        }

        #page-container {
            flex: 1 0 auto;
        }

        footer {
            flex-shrink: 0;
        }

        body.modal-open {
            overflow: hidden;
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--scrollbar-track);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--scrollbar-thumb);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--scrollbar-thumb-hover);
        }

        .elevation-2 {
            box-shadow: 0px 3px 1px -2px var(--shadow-umbra), 0px 2px 2px 0px var(--shadow-penumbra), 0px 1px 5px 0px var(--shadow-ambient);
        }

        .elevation-4 {
            box-shadow: 0px 2px 4px -1px var(--shadow-umbra), 0px 4px 5px 0px var(--shadow-penumbra), 0px 1px 10px 0px var(--shadow-ambient);
        }

        .elevation-8 {
            box-shadow: 0px 5px 5px -3px var(--shadow-umbra), 0px 8px 10px 1px var(--shadow-penumbra), 0px 3px 14px 2px var(--shadow-ambient);
        }

        .header-main {
            background-color: var(--header-bg);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        .header-title {
            font-size: 2rem;
            font-weight: 500;
            color: var(--text-color);
        }

        .header-subtitle {
            font-size: 0.875rem;
            color: var(--text-secondary-color);
        }

        .search-input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .search-container input {
            background-color: var(--search-bg);
            border: 1px solid var(--search-border);
            color: var(--text-color);
            border-radius: 0.5rem;
            padding-right: 2.5rem;
        }

        .search-container input::placeholder {
            color: var(--text-secondary-color);
        }

        .search-container input:focus {
            --tw-ring-color: var(--search-focus-ring);
            border-color: var(--search-focus-ring);
            box-shadow: 0 0 0 2px var(--search-focus-ring);
        }

        .search-clear-button {
            position: absolute;
            right: 0.5rem;
            padding: 0.25rem;
            color: var(--text-secondary-color);
            cursor: pointer;
            display: none;
        }

        .search-clear-button:hover {
            color: var(--text-color);
        }

        .search-clear-button svg {
            width: 1.25rem;
            height: 1.25rem;
        }

        .header-button {
            background-color: transparent;
            color: var(--icon-fill);
            border: none;
            padding: 0.625rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .header-button:hover {
            background-color: rgba(0, 0, 0, 0.04);
            color: var(--icon-hover-fill);
        }

        html.dark .header-button:hover {
            background-color: rgba(255, 255, 255, 0.08);
        }

        .header-button svg {
            width: 1.5rem;
            height: 1.5rem;
            fill: currentColor;
            margin-right: 0;
        }

        .header-button.text-button {
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
            font-weight: 500;
        }

        .header-button.text-button svg {
            margin-right: 0.5rem;
            width: 1.25rem;
            height: 1.25rem;
        }

        .tactic-column-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 0.28rem;
            padding: 1.5rem 0.5rem;
            align-items: flex-start;
            justify-content: center;
        }

        .tactic-column {
            flex-grow: 1;
            flex-shrink: 1;
            flex-basis: 160px;
            max-width: 210px;
            background-color: var(--column-bg);
            border-radius: 0.75rem;
            padding: 0.8rem;
            min-height: 200px;
            transition: background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .tactic-column-header {
            font-size: 1.25rem;
            font-weight: 500;
            color: var(--column-header-text);
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--column-border);
            transition: color 0.3s ease, border-color 0.3s ease;
            cursor: pointer;
            text-align: center;
        }

        .tactic-column-header:hover {
            color: var(--column-header-hover-text);
        }

        .technique-item {
            display: block;
            background-color: var(--technique-item-bg);
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
            color: var(--technique-item-text);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out, transform 0.2s ease, box-shadow 0.2s ease;
            line-height: 1.5;
            margin-bottom: 0.75rem;
        }

        .technique-item:hover {
            background-color: var(--technique-item-hover-bg);
            color: var(--technique-item-hover-text);
            transform: translateY(-2px);
        }

        .technique-item.highlight {
            background-color: var(--technique-item-highlight-bg);
            color: var(--technique-item-highlight-text);
            font-weight: 600;
        }

        .technique-id {
            font-weight: 500;
            color: var(--technique-id-text);
            font-size: 0.75rem;
            margin-right: 0.35rem;
            display: block;
            margin-bottom: 0.125rem;
        }

        .technique-name {
            font-weight: 500;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease, visibility 0.2s ease;
        }

        html.dark .modal-overlay {
            background-color: rgba(0, 0, 0, 0.7);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: var(--modal-content-bg);
            color: var(--text-color);
            padding: 2rem;
            border-radius: 0.5rem;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            transition: background-color 0.3s ease, color 0.3s ease, transform 0.2s ease;
            transform: scale(0.95);
        }

        .modal-overlay.active .modal-content {
            transform: scale(1);
        }

        .modal-content h2.modal-main-title {
            font-size: 1.75rem;
            font-weight: 500;
            margin-bottom: 1.5rem;
            color: var(--column-header-hover-text);
        }

        .modal-content h2 {
            font-size: 1.5rem;
            font-weight: 500;
            margin-bottom: 1rem;
            color: var(--column-header-hover-text);
        }

        .modal-content h3 {
            font-size: 1.25rem;
            font-weight: 500;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            color: var(--text-color);
        }

        .modal-content h4 {
            font-size: 1rem;
            font-weight: 500;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            color: var(--text-color);
        }

        .modal-content p {
            font-size: 0.9375rem;
            line-height: 1.7;
            margin-bottom: 1rem;
        }

        .modal-content ul {
            list-style-type: disc;
            margin-left: 1.5rem;
            font-size: 0.9375rem;
            line-height: 1.7;
            margin-bottom: 1rem;
        }

        .modal-content ul ul {
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .modal-content li {
            margin-bottom: 0.375rem;
        }

        .modal-content a {
            color: var(--link-color);
            text-decoration: none;
            font-weight: 500;
        }

        .modal-content a:hover {
            color: var(--link-hover-color);
            text-decoration: underline;
        }

        .modal-close-button {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.75rem;
            color: var(--modal-close-btn-text);
            cursor: pointer;
            line-height: 1;
            transition: color 0.3s ease;
            padding: 0.25rem;
        }

        .modal-close-button:hover {
            color: var(--modal-close-btn-hover-text);
        }

        .defends-against-framework {
            font-weight: 500;
            color: var(--technique-item-text);
            opacity: 0.9;
        }

        .defends-against-item {
            margin-left: 1rem;
            list-style-type: disc;
        }

        .site-footer {
            background-color: var(--footer-bg);
            color: var(--footer-text);
            padding: 1rem 1rem;
            text-align: center;
            font-size: 0.875rem;
            border-top: 1px solid var(--footer-border);
            margin-top: auto;
        }

        .site-footer p {
            margin-bottom: 0.25rem;
            line-height: 1.5;
        }

        html.dark .header-version-text {
            opacity: 1;
            color: var(--text-secondary-color);
        }

        .accordion-item {
            border-bottom: 1px solid var(--header-border);
        }

        .accordion-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.25rem 0.5rem;
            cursor: pointer;
            font-size: 1.125rem;
            font-weight: 500;
            color: var(--text-color);
            transition: color 0.2s ease;
        }

        .accordion-header:hover {
            color: var(--column-header-hover-text);
        }

        .accordion-icon {
            width: 1.25rem;
            height: 1.25rem;
            transition: transform 0.3s ease-in-out;
            flex-shrink: 0;
            margin-left: 1rem;
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-in-out, padding 0.3s ease-in-out;
            font-size: 0.9375rem;
            line-height: 1.7;
            color: var(--text-secondary-color);
        }

        .accordion-content-inner {
            padding: 0 0.5rem 1.25rem 0.5rem;
        }

        .strategy-accordion-container {
            margin-top: 0.5rem;
        }

        .strategy-accordion-item {
            border-bottom: 1px solid var(--column-border);
        }

        .strategy-accordion-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0.5rem;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .strategy-accordion-header:hover {
            color: var(--technique-item-hover-text);
        }

        .strategy-accordion-icon {
            width: 1rem;
            height: 1rem;
            transition: transform 0.3s ease-in-out;
            flex-shrink: 0;
            margin-left: 0.5rem;
        }

        .strategy-accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-in-out;
        }

        .strategy-accordion-content-inner {
            padding: 0.5rem 0.5rem 1rem 1rem;
            font-size: 0.85rem;
            line-height: 1.6;
            color: var(--text-secondary-color);
        }

        .strategy-accordion-content-inner h5 {
            font-weight: 600;
            margin-top: 0.75rem;
            margin-bottom: 0.25rem;
            color: var(--text-color);
        }

        .strategy-accordion-content-inner code {
            font-family: monospace;
            background-color: var(--search-bg);
            padding: 0.1rem 0.3rem;
            border-radius: 0.25rem;
            font-size: 0.8rem;
        }

        .strategy-accordion-content-inner pre {
            background-color: var(--search-bg);
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin: 0.5rem 0;
            overflow-x: auto;
        }

        .strategy-accordion-content-inner pre code {
            padding: 0;
            background: none;
        }

        .perf-impact-note {
            background-color: #f0f4f8;
            /* A light blue-gray background */
            border-left: 4px solid #4a90e2;
            /* A blue accent border */
            padding: 12px 18px;
            margin: 16px 0;
            border-radius: 4px;
            font-size: 0.9em;
            line-height: 1.6;
        }

        html.dark .perf-impact-note {
            background-color: #2c3e50;
            /* A dark blue-gray for dark mode */
            border-left-color: #5dade2;
            /* A lighter blue for dark mode */
        }

        .perf-impact-note p {
            margin: 0;
            padding: 0;
        }

        .perf-impact-note strong {
            color: var(--text-color);
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body class="text-gray-800">
    <div id="page-container">
        <header class="header-main py-4 px-6 fixed top-0 left-0 right-0 z-50 elevation-4">
            <div class="container mx-auto">
                <div class="flex justify-between items-center mb-3">
                    <div class="text-left">
                        <h1 class="header-title">AIDEFENDâ„¢</h1>
                        <p class="header-subtitle">An AI-focused defensive countermeasures knowledge base</p>
                        <p class="text-xs opacity-60 mt-0.5 header-version-text">Version 1.0</p>
                    </div>
                    <div class="flex items-center space-x-1">
                        <button id="aboutBtn" class="header-button text-button" title="About AIDEFEND">
                            About
                        </button>
                        <button id="themeToggleBtn" class="header-button" title="Toggle Theme">
                        </button>
                    </div>
                </div>
                <div class="search-input-wrapper search-container">
                    <input type="text" id="search-bar"
                        placeholder="Search keywords, AIDEFEND/ATLAS techniques, MAESTRO threats, OWASP Top10s, etc..."
                        class="w-full p-2.5 text-sm">
                    <button id="searchClearBtn" class="search-clear-button" title="Clear search">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                            <path fill-rule="evenodd"
                                d="M10 18a8 8 0 100-16 8 8 0 000 16ZM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22Z"
                                clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>
            </div>
        </header>

        <div id="content-wrapper" class="pt-44 px-4 sm:px-6 lg:px-8 pb-8">
            <main id="main-content" class="container mx-auto"></main>
        </div>
    </div>

    <div id="infoModal" class="modal-overlay">
        <div id="modalBackdrop" class="absolute inset-0"></div>
        <div class="modal-content elevation-8">
            <button id="modalClose" class="modal-close-button">&times;</button>
            <div id="modalBody"></div>
        </div>
    </div>

    <footer class="site-footer">
        <p>AIDEFEND, An AI-focused defensive countermeasures knowledge base.</p>
        <p>Information based on the <a
                href="https://cloudsecurityalliance.org/blog/2025/02/06/agentic-ai-threat-modeling-framework-maestro"
                target="_blank" rel="noopener noreferrer" class="text-sky-600 dark:text-sky-400 hover:underline">MAESTRO
                framework</a>, <a href="https://d3fend.mitre.org/" target="_blank" rel="noopener noreferrer"
                class="text-sky-600 dark:text-sky-400 hover:underline">MITRE D3FEND</a>, <a
                href="https://atlas.mitre.org/" target="_blank" rel="noopener noreferrer"
                class="text-sky-600 dark:text-sky-400 hover:underline">ATLAS</a>, <a href="https://attack.mitre.org/"
                target="_blank" rel="noopener noreferrer"
                class="text-sky-600 dark:text-sky-400 hover:underline">ATT&CK</a>, and <a
                href="https://owasp.org/www-project-top-10-for-large-language-model-applications/" target="_blank"
                rel="noopener noreferrer" class="text-sky-600 dark:text-sky-400 hover:underline">OWASP Top 10 LLM
                2025</a>/<a href="https://owasp.org/www-project-machine-learning-security-top-10/" target="_blank"
                rel="noopener noreferrer" class="text-sky-600 dark:text-sky-400 hover:underline">OWASP Top 10 ML
                Security 2023</a>.</p>
        <p>2025 Edward's Playground - AIDEFEND framework Initiative. For informational purposes only.</p>
        <p>All content on this website is licensed under the <a href="https://creativecommons.org/licenses/by/4.0/"
                target="_blank" rel="noopener noreferrer"
                class="text-sky-600 dark:text-sky-400 hover:underline">Creative Commons Attribution 4.0 International
                License (CC BY 4.0)</a></p>
    </footer>
    <script src="aidefend-data.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const mainContentEl = document.getElementById('main-content');
            const searchBarEl = document.getElementById('search-bar');
            const searchClearBtnEl = document.getElementById('searchClearBtn');
            const modalEl = document.getElementById('infoModal');
            const modalBackdropEl = document.getElementById('modalBackdrop');
            const modalBodyEl = document.getElementById('modalBody');
            const modalCloseBtn = document.getElementById('modalClose');
            const themeToggleBtn = document.getElementById('themeToggleBtn');
            const aboutBtn = document.getElementById('aboutBtn');
            const htmlEl = document.documentElement;

            const plusIcon = `<svg class="accordion-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" /></svg>`;
            const minusIcon = `<svg class="accordion-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 10a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H4.75A.75.75 0 014 10z" clip-rule="evenodd" /></svg>`;
            const sunIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.166a.75.75 0 00-1.06-1.06l-1.591 1.59a.75.75 0 101.06 1.061l1.591-1.59zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.834 18.894a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 10-1.061 1.06l1.59 1.591zM12 18a.75.75 0 01.75.75V21a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM7.758 17.303a.75.75 0 00-1.061-1.06l-1.591 1.59a.75.75 0 001.06 1.061l1.591-1.59zM6 12a.75.75 0 01-.75.75H3a.75.75 0 010-1.5h2.25A.75.75 0 016 12zM6.166 7.758a.75.75 0 001.06 1.06l1.591-1.59a.75.75 0 00-1.06-1.061L6.166 7.758z" /></svg>`;
            const moonIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 01.162.819A8.97 8.97 0 009 6a9 9 0 009 9 8.97 8.97 0 003.463-.69.75.75 0 01.981.98 10.503 10.503 0 01-9.694 6.46c-5.799 0-10.5-4.701-10.5-10.5 0-3.51 1.713-6.636 4.362-8.492a.75.75 0 01.819.162z" clip-rule="evenodd" /></svg>`;
            const infoIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0ZM9 9a.75.75 0 0 0 0 1.5h.253a.25.25 0 0 1 .244.304l-.459 2.066A1.75 1.75 0 0 0 10.747 15H11a.75.75 0 0 0 0-1.5h-.253a.25.25 0 0 1-.244-.304l.459-2.066A1.75 1.75 0 0 0 9.253 9H9Z" clip-rule="evenodd" /></svg>`;

            let currentSearchTerm = "";

            function applyTheme(theme) {
                if (theme === 'dark') {
                    htmlEl.classList.add('dark');
                    themeToggleBtn.innerHTML = sunIcon;
                } else {
                    htmlEl.classList.remove('dark');
                    themeToggleBtn.innerHTML = moonIcon;
                }
            }

            function toggleTheme() {
                const currentTheme = htmlEl.classList.contains('dark') ? 'dark' : 'light';
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                localStorage.setItem('aidefendTheme', newTheme);
                applyTheme(newTheme);
            }

            function renderMainGrid(searchTerm = "") {
                mainContentEl.innerHTML = '';
                const gridContainer = document.createElement('div');
                gridContainer.className = 'tactic-column-grid';
                const allTechniquesFlat = searchTerm ? aidefendData.tactics.reduce((acc, tactic) => {
                    if (tactic.techniques && Array.isArray(tactic.techniques)) {
                        tactic.techniques.forEach(tech => acc.push({ ...tech, tacticName: tactic.name }));
                    }
                    return acc;
                }, []) : [];
                const techniquesMatchingGlobalSearch = searchTerm ? allTechniquesFlat.filter(tech => {
                    const term = searchTerm.toLowerCase();
                    let match = tech.name.toLowerCase().includes(term) ||
                        tech.id.toLowerCase().includes(term) ||
                        (tech.description && tech.description.toLowerCase().includes(term));
                    if (!match && tech.defendsAgainst) {
                        for (const da of tech.defendsAgainst) {
                            if (da.items && da.items.some(item => item.toLowerCase().includes(term))) {
                                match = true;
                                break;
                            }
                        }
                    }
                    return match;
                }) : [];
                if (searchTerm && techniquesMatchingGlobalSearch.length === 0) {
                    mainContentEl.innerHTML = `<p class="text-center opacity-80 py-10">No techniques found matching "${searchTerm}".</p>`;
                    return;
                }
                aidefendData.tactics.forEach(tactic => {
                    let techniquesInThisTacticThatMatchSearch = [];
                    let columnShouldBeRendered = !searchTerm;
                    if (searchTerm) {
                        if (tactic.techniques && Array.isArray(tactic.techniques)) {
                            techniquesInThisTacticThatMatchSearch = tactic.techniques.filter(t =>
                                techniquesMatchingGlobalSearch.some(matchedTech => matchedTech.id === t.id)
                            );
                            if (techniquesInThisTacticThatMatchSearch.length > 0) {
                                columnShouldBeRendered = true;
                            }
                        } else {
                            columnShouldBeRendered = false;
                        }
                    }
                    if (!columnShouldBeRendered) {
                        return;
                    }
                    const column = document.createElement('div');
                    column.className = 'tactic-column elevation-2';
                    const tacticHeader = document.createElement('h3');
                    tacticHeader.className = 'tactic-column-header';
                    tacticHeader.textContent = tactic.name;
                    tacticHeader.onclick = () => showTacticModal(tactic);
                    column.appendChild(tacticHeader);
                    const ul = document.createElement('ul');
                    let techniquesToRenderInColumn;
                    if (searchTerm) {
                        techniquesToRenderInColumn = techniquesInThisTacticThatMatchSearch;
                    } else {
                        techniquesToRenderInColumn = (tactic.techniques && Array.isArray(tactic.techniques)) ? tactic.techniques : [];
                    }
                    if (techniquesToRenderInColumn.length > 0) {
                        techniquesToRenderInColumn.forEach(tech => {
                            const li = document.createElement('li');
                            const a = document.createElement('a');
                            a.href = '#';
                            a.className = 'technique-item elevation-2';
                            a.innerHTML = `<span class="technique-id">${tech.id}</span> <span class="technique-name">${tech.name}</span>`;
                            if (searchTerm && techniquesMatchingGlobalSearch.some(matchedTech => matchedTech.id === tech.id)) {
                                a.classList.add('highlight');
                            }
                            a.onclick = (e) => {
                                e.preventDefault();
                                showTechniqueModal(tech, tactic.name);
                            };
                            li.appendChild(a);
                            if (tech.subTechniques && tech.subTechniques.length > 0) {
                                const subList = document.createElement('ul');
                                subList.className = 'pl-3 pr-1 py-1 mt-1 space-y-2';
                                tech.subTechniques.forEach(subTech => {
                                    const subLi = document.createElement('li');
                                    const subA = document.createElement('a');
                                    subA.href = '#';
                                    subA.className = 'technique-item elevation-2 block !bg-[var(--technique-item-hover-bg)] !text-[var(--technique-item-hover-text)]';
                                    subA.innerHTML = `<span class="technique-id !text-[var(--technique-id-text)]">${subTech.id}</span> <span class="technique-name">${subTech.name}</span>`;
                                    if (searchTerm) {
                                        subA.classList.add('highlight');
                                    }
                                    subA.onclick = (e) => {
                                        e.preventDefault();
                                        e.stopPropagation();
                                        showTechniqueModal(subTech, tactic.name);
                                    };
                                    subLi.appendChild(subA);
                                    subList.appendChild(subLi);
                                });
                                li.appendChild(subList);
                            }
                            ul.appendChild(li);
                        });
                    } else if (!searchTerm && (!tactic.techniques || tactic.techniques.length === 0)) {
                        const p = document.createElement('p');
                        p.className = 'text-xs opacity-60 italic px-2';
                        p.textContent = 'No techniques defined yet for this tactic.';
                        ul.appendChild(p);
                    }
                    column.appendChild(ul);
                    gridContainer.appendChild(column);
                });
                mainContentEl.appendChild(gridContainer);
            }

            function showIntroductionModal() {
                const intro = aidefendData.introduction;
                let contentHtml = `<h2 class="modal-main-title">${intro.mainTitle}</h2>`;
                contentHtml += '<div class="accordion-container">';
                intro.sections.forEach((section, index) => {
                    contentHtml += `
                        <div class="accordion-item">
                            <div class="accordion-header" role="button" aria-expanded="${index === 0 ? 'true' : 'false'}">
                                <span>${section.title}</span>
                                <div class="icon-wrapper">${plusIcon}</div>
                            </div>
                            <div class="accordion-content">
                                <div class="accordion-content-inner">
                                    ${section.paragraphs ? section.paragraphs.map(p => `<p>${p}</p>`).join('') : ''}
                                    ${section.listItems ? `<ul>${section.listItems.map(item => `<li>${item}</li>`).join('')}</ul>` : ''}
                                    ${section.concludingParagraphs ? section.concludingParagraphs.map(p => `<p>${p}</p>`).join('') : ''}
                                </div>
                            </div>
                        </div>
                    `;
                });
                contentHtml += '</div>';
                modalBodyEl.innerHTML = contentHtml;
                const accordionHeaders = modalBodyEl.querySelectorAll('.accordion-header');
                accordionHeaders.forEach((header, index) => {
                    const content = header.nextElementSibling;
                    const iconWrapper = header.querySelector('.icon-wrapper');
                    if (index === 0) {
                        header.classList.add('active');
                        content.style.maxHeight = content.scrollHeight + 'px';
                        iconWrapper.innerHTML = minusIcon;
                    }
                    header.addEventListener('click', () => {
                        const isActive = header.classList.contains('active');
                        accordionHeaders.forEach(otherHeader => {
                            otherHeader.classList.remove('active');
                            otherHeader.nextElementSibling.style.maxHeight = null;
                            otherHeader.querySelector('.icon-wrapper').innerHTML = plusIcon;
                        });
                        if (!isActive) {
                            header.classList.add('active');
                            content.style.maxHeight = content.scrollHeight + 'px';
                            iconWrapper.innerHTML = minusIcon;
                        }
                    });
                });
                modalEl.classList.add('active');
                document.body.classList.add('modal-open');
            }

            function showTacticModal(tactic) {
                const fullTacticData = aidefendData.tactics.find(t => t.name === tactic.name) || tactic;
                modalBodyEl.innerHTML = `
                    <h2>${fullTacticData.name}</h2>
                    <p class="mb-4 leading-relaxed text-sm">${fullTacticData.purpose || 'No purpose description available.'}</p>
                `;
                modalEl.classList.add('active');
                document.body.classList.add('modal-open');
            }

            function renderDetailSectionListForModal(title, items) {
                if (!items || items.length === 0) return '';
                if (typeof items[0] === 'object' && items[0] !== null && items[0].strategy) {
                    let accordionHtml = `<div class="mt-4"><h3 class="font-semibold text-lg mb-2">${title}:</h3><div class="strategy-accordion-container">`;
                    items.forEach((item) => {
                        accordionHtml += `
                            <div class="strategy-accordion-item">
                                <div class="strategy-accordion-header" role="button">
                                    <span>${item.strategy}</span>
                                    <div class="icon-wrapper">${plusIcon}</div>
                                </div>
                                <div class="strategy-accordion-content">
                                    <div class="strategy-accordion-content-inner">${item.howTo || '<p>No detailed steps provided.</p>'}</div>
                                </div>
                            </div>
                        `;
                    });
                    accordionHtml += '</div></div>';
                    return accordionHtml;
                } else {
                    return `
                        <div class="mt-3">
                            <h4 class="font-semibold text-sm mb-1">${title}:</h4>
                            <ul class="list-disc list-inside ml-4 text-xs opacity-90 space-y-1">
                                ${items.map(item => `<li>${item}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }
            }

            function showTechniqueModal(technique, tacticName) {
                modalBodyEl.innerHTML = `
    <p class="text-sm opacity-80 mb-1">Tactic: ${tacticName}</p>
    <h2>${technique.id}: ${technique.name}</h2>
    <p class="mb-4 leading-relaxed text-sm">${technique.description || 'No description available.'}</p>
    
    ${technique.perfImpact ? `
        <div class="perf-impact-note">
            <p>
                <strong>ðŸ’¡ Performance Impact (${technique.perfImpact.level}):</strong>
                ${technique.perfImpact.description}
            </p>
        </div>
    ` : ''}
    ${renderDetailSectionListForModal('Implementation Strategies', technique.implementationStrategies)}
    ${renderDetailSectionListForModal('Potential Tools - Open Source', technique.toolsOpenSource)}
    ${renderDetailSectionListForModal('Potential Tools - Commercial', technique.toolsCommercial)}
    
    <div class="mt-4">
        <h4 class="font-semibold text-md mb-2">Defends Against:</h4>
        ${technique.defendsAgainst && technique.defendsAgainst.length > 0 ?
                        technique.defendsAgainst.map(da => `
                <div class="mb-2">
                    <p class="defends-against-framework text-sm">${da.framework}:</p>
                    <ul class="list-disc list-inside ml-4 text-xs opacity-90 space-y-0.5">
                        ${da.items.map(item => `<li>${item}</li>`).join('')}
                    </ul>
                </div>
            `).join('') : '<p class="text-xs opacity-60 italic">No specific defenses listed.</p>'}
    </div>
`;

                modalBodyEl.querySelectorAll('.strategy-accordion-header').forEach(header => {
                    header.addEventListener('click', () => {
                        const content = header.nextElementSibling;
                        const iconWrapper = header.querySelector('.icon-wrapper');
                        const isActive = header.classList.toggle('active');
                        iconWrapper.innerHTML = isActive ? minusIcon : plusIcon;
                        content.style.maxHeight = isActive ? content.scrollHeight + "px" : null;
                    });
                });

                modalEl.classList.add('active');
                document.body.classList.add('modal-open');
            }

            function hideModal() {
                modalEl.classList.remove('active');
                document.body.classList.remove('modal-open');
                modalBodyEl.innerHTML = '';
            }

            // Event Listeners
            themeToggleBtn.addEventListener('click', toggleTheme);
            aboutBtn.addEventListener('click', showIntroductionModal);
            searchBarEl.addEventListener('input', (e) => {
                currentSearchTerm = e.target.value.trim();
                searchClearBtnEl.style.display = currentSearchTerm ? 'block' : 'none';
                renderMainGrid(currentSearchTerm);
            });
            searchClearBtnEl.addEventListener('click', () => {
                searchBarEl.value = '';
                currentSearchTerm = '';
                searchClearBtnEl.style.display = 'none';
                renderMainGrid();
            });
            modalCloseBtn.addEventListener('click', hideModal);
            modalBackdropEl.addEventListener('click', hideModal);
            document.addEventListener('keydown', (event) => {
                if (event.key === 'Escape' && modalEl.classList.contains('active')) {
                    hideModal();
                }
            });

            // Initial Load
            const savedTheme = localStorage.getItem('aidefendTheme') || 'dark';
            applyTheme(savedTheme);
            aboutBtn.innerHTML = infoIcon.replace('w-5 h-5', 'w-4 h-4') + "About";
            renderMainGrid();
        });
    </script>
</body>
</html>